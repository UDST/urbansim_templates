

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started &mdash; UrbanSim Templates 0.2.dev9 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ModelManager API" href="modelmanager.html" />
    <link rel="prev" title="UrbanSim Templates" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> UrbanSim Templates
          

          
          </a>

          
            
            
              <div class="version">
                0.2.dev9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#production-releases">Production releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developer-pre-releases">Developer pre-releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cloning-the-repository">Cloning the repository</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initializing-modelmanager">Initializing ModelManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-model-step">Creating a model step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitting-the-statistical-model">Fitting the statistical model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-the-step">Registering the step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-changes">Making changes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modelmanager.html">ModelManager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="model-steps.html">Model step template APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-templates.html">Data management templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Shared utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UrbanSim Templates</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting-started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>UrbanSim Templates is a Python library that provides building blocks for Orca-based simulation models. It’s part of the <a class="reference external" href="http://docs.udst.org">Urban Data Science Toolkit</a> (UDST).</p>
<p>The library contains templates for common types of model steps, plus a tool called ModelManager that runs as an extension to the <a class="reference external" href="https://udst.github.io/orca">Orca</a> task orchestrator. ModelManager can register template-based model steps with the orchestrator, save them to disk, and automatically reload them for future sessions. The package was developed to make it easier to set up new simulation models — model step templates reduce the need for custom code and make settings more portable between models.</p>
<p>UrbanSim Templates is <a class="reference external" href="https://github.com/udst/urbansim_templates">hosted on Github</a> with a BSD 3-Clause open source license. The code repository includes some material not found in this documentation: a <a class="reference external" href="https://github.com/UDST/urbansim_templates/blob/master/CHANGELOG.md">change log</a>, a <a class="reference external" href="http://">contributor’s guide</a>, and instructions for <a class="reference external" href="https://github.com/UDST/urbansim_templates/blob/master/tests/README.md">running the tests</a>, <a class="reference external" href="http://">updating the documentation</a>, and <a class="reference external" href="http://">creating a new release</a>.</p>
<p>Another useful resource is the <a class="reference external" href="https://github.com/UDST/urbansim_templates/issues?utf8=✓&amp;q=is%3Aissue">issues</a> and <a class="reference external" href="https://github.com/UDST/urbansim_templates/pulls?q=is%3Apr">pull requests</a> on Github, which include detailed feature proposals and other discussions.</p>
<p>UrbanSim Templates was created in 2018 by Sam Maurer (<a class="reference external" href="mailto:maurer&#37;&#52;&#48;urbansim&#46;com">maurer<span>&#64;</span>urbansim<span>&#46;</span>com</a>), who remains the lead developer, with contributions from Paul Waddell, Max Gardner, Eddie Janowicz, Arezoo Besharati Zadeh, Xavier Gitiaux, and others.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>UrbanSim Templates is tested with Python versions 2.7, 3.5, 3.6, and 3.7.</p>
<p>As of Feb. 2019, there is an installation problem in Python 3.7 when using Pip (because of an issue with Orca’s PyTables dependency). Conda should work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It can be helpful to set up a dedicated Python environment for each project you work on. This lets you use a stable and replicable set of libraries that won’t be affected by other projects. Here are some good <a class="reference external" href="https://gist.github.com/smmaurer/f3a4f424a4aa877fb73e1cb2567bd89d">environment settings</a> for UrbanSim Templates projects.</p>
</div>
<div class="section" id="production-releases">
<h3>Production releases<a class="headerlink" href="#production-releases" title="Permalink to this headline">¶</a></h3>
<p>UrbanSim Templates can be installed using the Pip or Conda package managers. With Conda, you (currently) need to install UrbanSim separately; Pip will handle this automatically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">urbansim_templates</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">urbansim_templates</span> <span class="o">--</span><span class="n">channel</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">urbansim</span> <span class="o">--</span><span class="n">channel</span> <span class="n">udst</span>
</pre></div>
</div>
<p>Dependencies include <a class="reference external" href="http://numpy.org">NumPy</a>, <a class="reference external" href="http://pandas.pydata.org">Pandas</a>, and <a class="reference external" href="http://statsmodels.org">Statsmodels</a>, plus two other UDST libraries: <a class="reference external" href="http://udst.github.io/orca">Orca</a> and <a class="reference external" href="http://github.com/udst/choicemodels">ChoiceModels</a>. These will be included automatically when you install UrbanSim Templates.</p>
<p>Certain less-commonly-used templates require additional packages: currently, <a class="reference external" href="https://github.com/timothyb0912/pylogit">PyLogit</a> and <a class="reference external" href="http://scikit-learn.org">Scikit-learn</a>. You’ll need to install these manually to use the associated templates.</p>
<p>When new production releases of UrbanSim Templates come out, you can upgrade like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">urbansim_templates</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">update</span> <span class="n">urbansim_templates</span> <span class="o">--</span><span class="n">channel</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span>
</pre></div>
</div>
</div>
<div class="section" id="developer-pre-releases">
<h3>Developer pre-releases<a class="headerlink" href="#developer-pre-releases" title="Permalink to this headline">¶</a></h3>
<p>Developer pre-releases of UrbanSim Templates can be installed using the Github URL. These versions sometimes require having a developer release of <a class="reference external" href="http://github.com/udst/choicemodels">ChoiceModels</a> as well. Information about the developer releases can be found in Github <a class="reference external" href="https://github.com/UDST/urbansim_templates/pulls?q=is%3Apr">pull requests</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">udst</span><span class="o">/</span><span class="n">choicemodels</span><span class="o">.</span><span class="n">git</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">udst</span><span class="o">/</span><span class="n">urbansim_templates</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>You can use the same command to upgrade.</p>
</div>
<div class="section" id="cloning-the-repository">
<h3>Cloning the repository<a class="headerlink" href="#cloning-the-repository" title="Permalink to this headline">¶</a></h3>
<p>If you’ll be modifying the code, you can install UrbanSim Templates by cloning the Github repository:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">udst</span><span class="o">/</span><span class="n">urbansim_templates</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">urbansim_templates</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>
</div>
<p>Update it with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code>.</p>
</div>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initializing-modelmanager">
<h3>Initializing ModelManager<a class="headerlink" href="#initializing-modelmanager" title="Permalink to this headline">¶</a></h3>
<p>To get started, import and initialize ModelManager. This makes sure there’s a directory set up to store any template-based model steps that are generated within the script or notebook.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urbansim_templates</span> <span class="kn">import</span> <span class="n">modelmanager</span>

<span class="n">modelmanager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
<p>The default file location is a <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder located in the current working directory; you can provide an alternate path if needed. If ModelManager finds existing saved objects in the directory, it will load them and register them with Orca.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It can be helpful to add a cell to your notebook that reports which version of UrbanSim Templates is installed, particularly if you’re using development releases!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">urbansim_templates</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">urbansim_templates</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;0.2.dev0&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-model-step">
<h3>Creating a model step<a class="headerlink" href="#creating-a-model-step" title="Permalink to this headline">¶</a></h3>
<p>Now we can choose a template and use it to build a model step. The templates are Python classes that contain logic for setting up and running different kinds of model logic — currently focusing on OLS regressions and discrete choice models.</p>
<p>A template takes a variety of arguments, which can either be passed as parameters or set as object properties after an instance of the template is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urbansim_templates.models</span> <span class="kn">import</span> <span class="n">OLSRegressionStep</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">OLSRegressionStep</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;price-prediction&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="s1">&#39;buildings&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="n">model_expression</span> <span class="o">=</span> <span class="s1">&#39;sale_price ~ residential_sqft&#39;</span>
</pre></div>
</div>
<p>This sets up <code class="docutils literal notranslate"><span class="pre">m</span></code> as an instance of the OLS regression template. The <code class="docutils literal notranslate"><span class="pre">tables</span></code> and <code class="docutils literal notranslate"><span class="pre">model_expression</span></code> arguments refer to data that needs to be registered separately with Orca. So let’s load the data before trying to estimate the model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">orca</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.dropbox.com/s/vxg5pdfzxrh6osz/buildings-demo.csv?dl=1&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">orca</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="s1">&#39;buildings&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fitting-the-statistical-model">
<h3>Fitting the statistical model<a class="headerlink" href="#fitting-the-statistical-model" title="Permalink to this headline">¶</a></h3>
<p>Now we can fit the building price model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>This will print a summary table describing the estimation results.</p>
<p>Now that we have a fitted model, we can use it to predict sale prices for other buildings. UrbanSim forecasting models consist of many interconnected steps like this, iteratively predicting real estate prices, household moves, construction, and other urban dynamics.</p>
</div>
<div class="section" id="registering-the-step">
<h3>Registering the step<a class="headerlink" href="#registering-the-step" title="Permalink to this headline">¶</a></h3>
<p>Now we can register the model step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelmanager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<p>ModelManager parses the step, saves a copy to disk, and registers a runnable version of it as a standard Orca step, so that it can be invoked as part of a sequence of other steps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">orca</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;price-prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;household-moves&#39;</span><span class="p">,</span> <span class="s1">&#39;residential-development&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>In real usage, some additional parameters would be set to specify which data to use for prediction, and where to store the output.</p>
</div>
<div class="section" id="making-changes">
<h3>Making changes<a class="headerlink" href="#making-changes" title="Permalink to this headline">¶</a></h3>
<p>ModelManager also includes some interactive functionality. Previously registered steps can be retrieved as template objects, which can be modified and re-registered as needed. This also works with model steps loaded from disk.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">modelmanager</span><span class="o">.</span><span class="n">list_steps</span><span class="p">()</span>

<span class="n">m2</span> <span class="o">=</span> <span class="n">modelmanager</span><span class="o">.</span><span class="n">get_step</span><span class="p">(</span><span class="s1">&#39;price-prediction&#39;</span><span class="p">)</span>
<span class="o">...</span>

<span class="n">m2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;better-price-prediction&#39;</span>
<span class="n">modelmanager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="n">modelmanager</span><span class="o">.</span><span class="n">remove_step</span><span class="p">(</span><span class="s1">&#39;price-prediction&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you take a look in the <code class="docutils literal notranslate"><span class="pre">configs</span></code> folder, you’ll see a yaml file representing the saved model step. It includes the settings we provided, plus the fitted coefficients and anything else generated by the internal logic of the template.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modelmanager.html" class="btn btn-neutral float-right" title="ModelManager API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="UrbanSim Templates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, UDST

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>